\documentclass[10pt,twoside,a4paper]{book}
\usepackage{czech}
\usepackage[latin2]{inputenc}
\usepackage{graphics}
\usepackage{float}            % floating boxes (i.e. images)
\usepackage{a4wide}           % wider page layout
\usepackage{fancyhdr}         % control header & footer
\usepackage{sectsty}          % section header customization
\usepackage[numbers]{natbib}  % enhanced citation references
\usepackage{pgfplots}         % plots
\usepackage[top=3.6cm,bottom=3.5cm,inner=3.5cm,outer=2.6cm]{geometry} %custom page layout
\usepackage[bookmarks=true,unicode]{hyperref}

\usetikzlibrary{patterns}

\sectionfont{\sffamily}
\chapterfont{\sffamily}

\fancypagestyle{plain}{
	\fancyhf{}
	\renewcommand{\headrulewidth}{0pt}
	\fancyfoot[CE,CO]{\thepage}
}

\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}

% No headers on empty pages before new chapter - http://www.markschenk.com/tensegrity/latexexplanation.html
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
    \hbox{}
    \thispagestyle{plain}
    \newpage
    \if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother \clearpage{\pagestyle{plain}\cleardoublepage}

\setlength{\skip\footins}{1.5em}

\begin{document}
\pagenumbering{roman}

\begin{titlepage}
\begin{center}
\vspace*{\stretch{2}}
{\Huge\sffamily\bfseries Podpora vývoje rozšíøení PHP CMS}

\vspace*{2em}
{\Large\sffamily\bfseries Martin Schmied}

\vspace*{\stretch{0.7}}
\resizebox{0.4\textwidth}{!}{\includegraphics{resource/vse-logo.png}}

\vspace*{\stretch{3}}
\end{center}
\end{titlepage}

\tableofcontents 

\cleardoublepage
\pagenumbering{arabic}

\chapter*{Úvod} \addcontentsline{toc}{chapter}{Úvod}
Web vznikl na poèátku devadesátých let minulého století jako místo pro snadné sdílení informací formou vzájemnì propojených dokumentù. Za dvacet let své existence prošel mnoha promìnami. Posun od webu èistì informaèního k webu aplikaènímu udìlal z webového prohlížeèe jeden z nejdùležitìjších (a v urèitých pøípadech prakticky jediný) program potøebný k produktivní práci i pro zprostøedkování zábavy. Pøes všechny tyto zmìny je dnešní web stále, stejnì jako v dobách svého vzniku, pøedevším platformou pro sdílení informací.

I v oblasti webového obsahu však došlo k bouølivému vývoji a to jak na stranì vydavatelù, tak na stranì konzumentù. Postupem èasu rapidnì vzrostl význam multimediálního obsahu, který je navíc potøeba ve velmi krátkých intervalech obmìòovat èi doplòovat. Model webu, na kterém jsou jednotlivé HTML dokumenty ruènì vytváøeny a upravovány lidmi brzy pøestal vyhovovat vzrùstajícím nárokùm na interaktivitu a aktuálnost. Brzy zaèaly vznikat aplikace zamìøené na správu webového obsahu (\emph{Content Management Systems} -- CMS), aby ulehèily práci vydavatelùm a poskytly dodateèné služby konzumentùm.

Na poli systémù typu CMS bychom nalezli nepøeberné množství komerèních øešení. Vedle nich ale existuje také nezanedbatelné množství open source systémù, z nichž nìkolika nejvìtším patøí velmi významný podíl na svìtovém webu.\footnote{Kupøíkladu k 15.5.2011 pohání dle prohlášení na domovské stránce \url{http://www.joomla.org} open source systém Joomla 2.7\,\% celého webu.} Základem úspìchu open source CMS je aktivní komunita uživatelù a vývojáøù. Základní distribuce tìchto systémù pøedstavují pouze jádro, které lze pomocí velkého množství rozšíøení pøizpùsobovat konkrétním požadavkùm tvùrcù webového obsahu.

Tato práce se zamìøuje na nedílnou souèást zdravé komunity kolem open source CMS -- vývojáøe jejich rozšíøení. Pøesnìji na efektivitu jejich práce. Ta je závislá nejen na kvalitì jádra CMS a pokroku webu jako takového, ale také na kvalitì jejich vývojáøských nástrojù. I v této oblasti dochází k prùbìžnému zlepšování, jež ve svém dùsledku vede k širší nabídce lepších (a nìkdy levnìjších) rozšíøení. Z toho pak profitují nejen tvùrci obsahu, ale nepøímo všichni uživatelé webu. Souèasná úroveò dostupných vývojáøských nástrojù však v mnoha ohledech není ideální. Cílem této práce  je identifikace problematických oblastí pøi vývoji rozšíøení CMS systémù se zamìøením na specifika systému Joomla\footnote{Oficiální název systému je \uv{Joomla!} -- kvùli možné zámìnì s interpunkcí bude v prùbìhu práce uvádìn bez koncového vykøièníku.}. Výsledkem by mìl být návrh a prototypová implementace nástrojù pro usnadnìní vývoje rozšíøení systému Joomla ve vývojovém prostøedí Eclipse.

\chapter{Vývoj rozšíøení pro PHP CMS}
Primární cílovou skupinou open source CMS nebyly v dobì jejich vzniku velké korporace a jejich webové portály. Mnoho jich zaèínalo na pøesnì opaèném konci spektra -- u osobních stránek a zápisníkù. Tady slavily velké úspìchy a nìkteré systémy tuto orientaci dodnes neopustily. Není proto pøekvapením, že nejrozšíøenìjší open source CMS jsou postaveny nad platformou PHP, která se již dlouhou dobu vyznaèuje širokou nabídkou hostingových služeb, z nichž velké množství je nabízeno zdarma èi za symbolický poplatek. Kombinace PHP hostingu zdarma a open source CMS je tak pro mnoho lidí nejsnazší a nejlevnìjší cestou k vlastní webové prezentaci.

Obrázky \ref{fig:cmsdownloads} a \ref{fig:cmsinstallations} ukazují porovnání popularity open source CMS podle poètu stažení a podle poètu instalací zjištìných v prùzkumu tržního zastoupení tìchto systémù provedeného agenturou water\&stone v roce 2010 \citep[viz][]{shreves10}. I když se poøadí jednotlivých systémù liší dle zvoleného kritéria popularity, je zøejmé, že velká vìtšina tržního podílu pøipadá PHP CMS. Dále si mùžeme všimnout tøí nejpopulárnìjších open source CMS, jimiž jsou WordPress, Joomla a Drupal. Právì u nich budeme zkoumat možnosti rozšiøování a doporuèené postupy pro vývojáøe rozšíøení. Nejprve se ale podívejme na nástroje pro podporu vývoje na platformì PHP, pro kterou jsou všechny tyto systémy urèeny.

\begin{figure}[h]
\centering
\begin{tikzpicture}
\begin{axis}[
    symbolic y coords={Umbraco [PHP],Alfresco [Java],eZ Publish [PHP],Typo3 [PHP],Liferay [Java],CMSMadeSimple [PHP],DotNetNuke [ASP.NET],Drupal [PHP],Joomla [PHP],WordPress [PHP]},
    scaled x ticks=false,
    ytick=data]
    \addplot[xbar,draw=blue,pattern=horizontal lines light blue] coordinates {
        (983625,WordPress [PHP])
        (113836,Joomla [PHP])
        (33671,Drupal [PHP])
        (13000,DotNetNuke [ASP.NET])
        (9948,CMSMadeSimple [PHP])
        (9435,Liferay [Java])
        (7461,Typo3 [PHP])
        (7031,eZ Publish [PHP])
        (7000,Alfresco [Java])
        (5420,Umbraco [PHP])
    };
\end{axis}
\end{tikzpicture}
\caption{Prùmìrný poèet stažení za jeden týden bìhem roku 2010. \citep{shreves10}} \label{fig:cmsdownloads}
\end{figure}

\begin{figure}[h]
\centering
\begin{tikzpicture}
\begin{axis}[
    symbolic y coords={Concrete5 [PHP],Alfresco [Java],CMSMadeSimple [PHP],Tiky [PHP],Typo3 [PHP],Liferay [Java],DotNetNuke [ASP.NET],Drupal [PHP],WordPress [PHP],Joomla [PHP]},
    ytick=data]
    \addplot[xbar,draw=blue,pattern=horizontal lines light blue] coordinates {
        (1297,Joomla [PHP])
        (1012,WordPress [PHP])
        (575,Drupal [PHP])
        (402,DotNetNuke [ASP.NET])
        (154,Liferay [Java])
        (122,Typo3 [PHP])
        (82,Tiky [PHP])
        (72,CMSMadeSimple [PHP])
        (70,Alfresco [Java])
        (62,Concrete5 [PHP])
    };
\end{axis}
\end{tikzpicture}
\caption{Poèet instalací zjištìných v anketì agentury water\&stone.	 \citep{shreves10}} \label{fig:cmsinstallations}
\end{figure}

\section{Nástroje pro podporu vývoje v PHP}
PHP patøí mezi nejpopulárnìjší programovací jazyky. V kvìtnu 2011 se jazyk PHP na žebøíèku TIOBE Programming Community Index\footnote{TIOBE Programming Community Index mìøí popularitu programovacích jazykù na základì poètu výsledkù vrácených vyhledávacími službami pro dotazy na jednotlivé jazyky.} umístil na páté pozici za Javou, C, C++ a C\# \citep{tiobe}. Dle tìchto výsledkù se tak jedná o nejpopulárnìjší dynamicky typovaný jazyk vùbec. Právì dynamický skriptovací charakter PHP má zásadní vliv na volbu nástrojù pro podporu vývoje, jak bude ukázáno dále.

Hlavním zamìøením PHP je vývoj webových aplikací. Samotné jádro PHP poskytuje pouze elementární podporu pro tento typ vývoje a pro praktické využití je proto více než žádoucí využití nìkterého z aplikaèních frameworkù, nebo alespoò nìkterých rozšiøujících knihoven. Aèkoliv PHP pùvodnì není objektovì orientovaný jazyk (a jeho objektová nadstavba byla do verze PHP5 pøinejmenším problematická), dnešní nejrozšíøenìjší frameworky nabízejí primárnì objektovì orientované API\footnote{Podle prùzkumu popularity PHP frameworkù publikovaném na DZone.com \citep[viz][]{phpfrmwpoll} jsou nerozšíøenìjší Zend Framework, Symfony, CodeIgniter a CakePHP. Zajímavým fenoménem v pøípadì PHP však zùstává velké množství privátních mini-frameworkù, jež jsou udržovány pouze pro využití v rámci jedné spoleènosti èi dokonce jediným vývojáøem -- ty pak v mnoha pøípadech objektových vlastností jazyka vùbec nevyužívají.}. V kontextu vývoje rozšíøení pro open source CMS pak mùžeme jako framework chápat CMS samotné.

V oblasti nástrojù používaných pøi vývoji PHP aplikací bychom jen stìží hledali všeobecnì doporuèený, univerzálnì využitelný mix nástrojù. To je dáno množstvím faktorù -- zmiòme alespoò nìkteré:
\begin{itemize}
\item Dynamický charakter jazyka neumožòuje vytvoøení stejnì kvalitních editaèních nástrojù, jaké jsou k dispozici pro staticky typované jazyky. Schopnosti kontextové nápovìdy jsou i u profesionálních nástrojù znaènì omezené, automatický refaktoring nespolehlivý a podobnì.
\item Dlouhou dobu nebyly pro PHP k dispozici kvalitní vývojová prostøedí (dále IDE -- Integrated Development Environment) zdarma. Pro mnoho vývojáøù je pøitom PHP prvním jazykem, se kterým se v životì setkají -- jelikož nemají zkušenosti se staticky typovanými jazyky, ve kterých jsou výhody IDE nedocenitelné, a èasto také nechtìjí investovat prostøedky do komerèních nástrojù, uchylují se èasto k editorùm s pouze základní funkèností jako je zvýrazòování syntaxe.
\item V neposlední øadì hraje svou roli rozdílnost jednotlivých aplikaèních frameworkù, nad kterými jsou PHP aplikace vystavìny. Nìkteré (napø. Symfony) využívají rozhraní pro pøíkazovou øádku umožòující automatické generování kódu a úpravy konfigurací, jiné spoléhají èistì na ruènì psaný kód. Nìkteré vynucují striktní organizaci definic tøíd a nabízejí jejich automatické naèítání, jiné nechávají naèítání tøíd na zodpovìdnosti programátora.
\end{itemize}

\noindent Pøes všechny odlišnosti pøi vývoji rozlièných typù aplikací bychom našli nìkolik typù nástrojù, které jsou pro vývoj v PHP buï nezbytné, nebo lze jejich použití pøinejmenším doporuèit. Dále je uveden jejich pøehled v poøadí podle subjektivní dùležitosti z pohledu autora. V pøehledu je vynecháno bìhové prostøedí pro testování vyvíjených aplikací, jehož podoba se bude lišit v závislosti na typu aplikace\footnote{Typický základ bìhového prostøedí pro webové aplikace v PHP je Apache web server s PHP interpretrem a relaèní databáze MySQL}.

\subsection{Editor}
Základním nástrojem nutným pro vývoj PHP aplikací je editor zdrojového kódu. I když lze pro tento úèel teoreticky využít jakýkoli editor umožòující úpravy prostého textu, je kvùli vyšší produktivitì více než žádoucí využívat editory s pokroèilejšími funkcemi. Mezi základní funkce editoru zvyšující produktivitu vývoje patøí napøíklad zvýrazòování syntaxe, šablony pro bìžnì používané konstrukce nebo automatické formátování. Nìkteré z tìchto funkcí najdeme i u pomìrnì jednoduchých multifunkèních editorù\footnote{Do této kategorie mùžeme zaøadit napøíklad jEdit, Notepad++, nebo v Èeské republice oblíbený PSPad.} podporujících editaci zdrojového kódu v rùzných programovacích jazycích. Pokroèilé funkce, u kterých je velká èást implementace v editoru specifická pro konkrétní programovací jazyk, jsou potom až na výjimky dostupné jen u komplexnìjších nástrojù spadajících do kategorie IDE. K tìmto funkcím patøí napøíklad kontextová nápovìda, automatický refaktoring a integrace s debuggerem.

Jelikož je PHP témìø výhradnì využíváno k vývoji webových aplikací, musí editor umožòující produktivní práci podporovat nejen editaci PHP skriptù, ale i HTML stránek, CSS stylù a JavaScriptu. Pøi porovnání jednoduchých multifunkèních editorù a IDE je v pøípadì tìchto dalších jazykù situace podobná jako u PHP samotného -- základní funkcionalitu nabízejí témìø všechny nástroje, pokroèilé funkce pouze IDE.

I pøes veškeré výhody IDE\footnote{Je korektní zmínit, že využití IDE mùže mít i urèité nevýhody -- napøíklad velkou složitost a malou flexibilitu. Èasto se také stává, že je IDE \uv{pøíliš chytré} -- napøíklad bude hlásit jakoukoliv neukonèenou znaèku v XHTML souboru jako chybu, což se zdá být v poøádku do doby, než potøebujete v jednom souboru uložit šablonu zaèátku stránky.} stále velké množství PHP vývojáøù využívá k editaci zdrojového kódu multifunkèních editorù. Najde se ale i øada vývojáøù využívající pokroèilé funkcionality IDE. Tìm je k dispozici nìkolik komerèních produktù a dvì open source øešení vzešlá z populárních IDE primárnì urèených pro programovací jazyk Java -- Eclipse a Netbeans. Eclipse zároveò slouží jako základ pro dvì další IDE -- komerèní Zend Studio a open source Aptana Studio.

\subsection{Nástroj pro správu verzí}
Dalším nástrojem, bez kterého si lze jen tìžko pøedstavit jakýkoliv praktický vývoj SW je VCS (Version Control System) nástroj. V pøípadì VCS je situace v PHP stejná jako u jakéhokoli jiného programovacího jazyka -- lze využít kterýkoliv existující VCS podporovaný na operaèním systému používaném pøi vývoji. Pøi používání VCS lze pøitom typicky volit ze tøech typù uživatelských rozhraní:
\begin{itemize}
\item rozhraní pro pøíkazovou øádku,
\item samostatná aplikace nabízející grafické uživatelské rozhraní,
\item integrace VCS v IDE.
\end{itemize}

\noindent Pro uživatele IDE je samozøejmì nejpøíznivìjší tøetí varianta zpøístupòující funkce VCS a rozhraní pro vizualizaci rozdílù mezi verzemi uvnitø vývojového prostøedí. Jistou nevýhodou je omezené množství VCS systémù podporovaných v daném IDE, které omezuje jejich vzájemnou kombinovatelnost. V tomto ohledu jsou výhodné velké otevøené IDE platformy (jako Netbeans a pøedevším Eclipse), pro nìž existuje mnoho zásuvných modulù pro rùzné VCS systémy využitelné stejnì tak dobøe pro vývoj v Javì jako v PHP, nebo jakémkoli jiném jazyku podporovaném na dané platformì.

\subsection{Debugger}
Mezi PHP vývojáøi je stále pomìrnì rozšíøenou praktikou pøidávání ladících výstupù do kódu namísto využívání debuggeru. Interaktivní ladìní s pomocí debuggeru je témìø výhradnì dostupné pouze uživatelùm IDE\footnote{I když existují výjimky z tohoto pravidla a jako front-end pro debugger lze se správným zásuvným modulem využít napøíklad i slavný editor vim. \citep[viz][]{xdebugvim}}. I mezi nimi se však najdou mnozí, kteøí dají pøednost ladícím výstupùm pøed debuggerem. Z pohledu efektivity práce je však využívání debuggeru ve vìtšinì pøípadù lepší zpùsob ladìní programu, zvláštì pak u komplexních aplikací. Je tak dalším argumentem pro používání IDE.

\subsection{Knihovna pro jednotkové testy}
Další nedostateènì rozšíøenou praktikou v PHP komunitì je tvorba jednotkových testù. Jejich (ne-)existence má pøitom zásadní dopad na kvalitu výsledného softwarového produktu, jelikož v kódu dobøe pokrytém jednotkovými testy dochází k mnohem ménì neobjeveným regresím\footnote{Regrese v SW je situace, kdy úprava zdrojového kódu zpùsobí rozbití funkènosti, která pøed zmìnou fungovala dobøe. K regresím navíc èasto dochází na naprosto neèekaných místech, která se zmìnou kódu, jež je zpùsobila, zdánlivì nesouvisí.}. Automatické testování je pøitom u dynamických interpretovaných jazykù ještì mnohem dùležitìjší, než u staticky typovaných kompilovaných jazykù, ve kterých je mnoho potenciálních chyb odhaleno bìhem pøekladu. Pro tvorbu jednotkových testù v PHP jsou k dispozici knihovny PHPUnit a SimpleTest. Podpora tìchto knihoven v IDE se rùzní, ale zpravidla je možné pøinejmenším spouštìní testù pøímo z IDE a prohlížení jejich výsledkù.

Jako doplnìk jednotkových testù (nebo do jisté míry jejich alternativu) lze využít nástrojù pro tvorbu webových testovacích scénáøù. Tyto nástroje umožòují skrze zásuvný modul v prohlížeèi nahrát urèité chování uživatele na stránce a vytvoøit sadu testù na oèekávaný výstup zpracování uživatelských akcí. Nahrané chování pak nástroj umí automaticky pøehrát v prohlížeèi vèetnì spuštìní testù správnosti výstupu. Tyto nástroje jsou nezávislé na konkrétní technologii použité na serveru\footnote{I když nìkteré nabízejí integraci s knihovnami pro psaní testù ve vybraných jazycích. Scénáø lze pak pouštìt jako automatický integraèní test.}. Ze zástupcù lze zmínit napøíklad Selenium èi Windmill.

\subsection{Nástroj pro automatizaci sestavování}
Nástroje pro automatizaci sestavování (tzv. \uv{build automation tools}) jsou témìø nezbytnou pomùckou pøi vývoji jakékoliv složitìjší aplikace v kompilovaném jazyku. Pomohou ovšem i s automatizací pøípravy distribuèního balíèku PHP aplikace, zejména pokud je souèástí sestavení pøíprava testovacího prostøedí a spouštìní automatických testù. Pøímo pro PHP je k dispozici nástroj Phing vycházející z Antu, nástroje primárnì urèeného pro automatizaci sestavení Java aplikací.

Pro rozsáhlejší èi dlouhodobìjší projekty je vhodné využít integraèního serveru, který mùže iniciovat sestavení distribuce (spolu se spuštìním testù) v pravidelných èasových intervalech (nebo napøíklad po commitu do VCS systému), emailem upozoròovat na selhávající testy a podobnì. Velmi flexibilním open source integraèním serverem využitelným i pro vývoj PHP aplikací je napøíklad Jenkins.

\subsection{Další nástroje}
Výèet nástrojù využitelných pøi vývoji PHP aplikací jistì není úplný. Z dosud nezmínìných mùžeme vybrat napøíklad nástroje pro generování dokumentace (napø. phpDocumentor), nástroje pro statickou analýzu kódu (napø. PHP zásuvný modul pro Sonar integrující více takových nástrojù) èi issue tracking systém (napø. Redmine). V závislosti na typu vyvíjené aplikace bychom pak tento seznam mohli dále rozšiøovat.

\section{Rozšíøení PHP CMS}
Podívejme se podrobnìji na možnosti tvorby rozšiøování funkènost nejrozšíøenìjších open source CMS. Bude nás zajímat, co odlišuje rozšíøení od bìžné sady PHP skriptù (tj. jakým zpùsobem je integrováno s CMS). Pøedevším se však zamìøíme na doporuèené postupy práce pøi vývoji jednoduchého rozšíøení a budeme se snažit identifikovat místa, ve kterých lze tuto práci zefektivnit pøidáním specifické podpory pro tento typ vývoje do IDE. Samozøejmì nás také bude zajímat souèasná nabídka speciálních nástrojù pro vývoj rozšíøení CMS.

%TODO: pracovní název kapitoly
\chapter{Podpora vývojáøe rozšíøení CMS Joomla!}

%TODO: pracovní název kapitoly
\chapter{Implementace nástrojù pro podporu vývoje rozšíøení CMS Joomla! v Eclipse IDE}

\cleardoublepage
\chapter*{Závìr} \addcontentsline{toc}{chapter}{Závìr}
TODO: nìco na závìr... 

\begin{thebibliography}{99}

\bibitem{shreves10} SHREVES, Ric. \emph{2010 Open Source CMS Market Share Report} [online]. Bali, Indonesia : water\&stone, 10.12.2010 [cit. 2011-05-15]. Dostupné z WWW: \textless\url{http://www.waterandstone.com/book/2010-open-source-cms-market-share-report}\textgreater.

\bibitem{tiobe} TIOBE Software BV. \emph{TIOBE Programming Community Index for May 2011} [online]. 2011 [cit. 2011-05-22]. Dostupné z WWW: \textless\url{http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html}\textgreater.

\bibitem{phpfrmwpoll} SIRONI, Giorgio. \emph{The PHP frameworks poll results} [online]. 2011 [cit. 2011-05-22]. Dostupné z WWW: \textless\url{http://css.dzone.com/articles/php-frameworks-poll-results}\textgreater.

\bibitem{xdebugvim} Box.net, Inc. \emph{How to Debug PHP with Vim and XDebug on Linux} [online]. 2007 [cit. 2011-05-22]. Dostupné z WWW: \textless\url{http://tech.blog.box.net/2007/06/20/how-to-debug-php-with-vim-and-xdebug-on-linux/}\textgreater.

%\bibitem{pdt-home} The Eclipse Foundation. \emph{PHP Development Tools Project} [online]. 2011 [cit. 2001-05-15]. Dostupné z WWW: \textless\url{http://eclipse.org/pdt/}\textgreater.

\end{thebibliography}

\end{document}
